
<div class ="container">
 <h2 class ="mt-3">ãƒ­ã‚±åœ°è©³ç´°</h2>
 <div class ="row">
   <div class ="col-12 col-md-5 mt-4">
     <div>æŠ•ç¨¿è€…ï¼š<%= @post.user.name %>ã€€æŠ•ç¨¿æ—¥ï¼š<%= @post.created_at.strftime('%Y/%m/%d') %></div>
     <div>
      <% if @post.image.attached? %>
       <%= image_tag @post.image, size: "300x300" %>
      <% else %>
       <%= image_tag 'no-image', size: "300x300" %>
      <% end %>
     </div>
     <div>ã‚³ãƒ¡ãƒ³ãƒˆä»¶æ•°ï¼š<%= @post.comments.count %>&nbsp;&nbsp;

     <% if @post.favorited_by?(current_user) %>
      <%= link_to post_favorites_path(@post), method: :delete do %>
       â¤ï¸<%= @post.favorites.count %> ã„ã„ã­
      <% end %>
     <% else %>
      <%= link_to post_favorites_path(@post), method: :post do %>
       ğŸ¤<%= @post.favorites.count %> ã„ã„ã­
      <% end %>
     <% end %>
     </div>
   </div>


   <div class ="col-10 col-md-7 mt-4">
    <table class ="table table-borderless">
      <tr>
       <th class ="col-3 col-md-3">å ´æ‰€å</th>
       <th><%= @post.title %></th>
      </tr>
      <tr>
       <th class ="col-3 col-md-3">ç›®çš„</th>
       <th><%= @post.body %></th>
      </tr>
      <tr>
       <th class ="col-3 col-md-3">ã‚¿ã‚°</th>
       <th>
        <% unless @post.tags.nil? %>
         <% @post.tags.each do |tag| %>
          <%= tag.name %>,
         <% end %>
        <% end %>
       </th>
      </tr>
      <tr>
       <th class ="col-3 col-md-3">è©•ä¾¡</th>
       <th>
        <span id ="show_star"></span>
       </th>
      </tr>
      <tr>
       <th class ="col-3 col-md-3">éƒµä¾¿ç•ªå·</th>
       <th><%= @post.postal_code %></th>
      </tr>
      <tr>
       <th class ="col-3 col-md-3">ä½æ‰€</th>
       <th>
        <%= @post.address %>
       </th>
      </tr>
    </table>
    <div id ="map"></div>
    <!-- ãƒ­ã‚±åœ°è©³ç´°ç”»é¢ã§ã¯èª°ã§ã‚‚ç·¨é›†ç­‰ã§ããªã„æ–¹ãŒã„ã„ï¼Ÿ-->
    <!--<div class ="mt-2">-->
    <!-- <% if @post.user == current_user %>-->
    <!--  <%= link_to 'ç·¨é›†ã™ã‚‹', edit_post_path(@post), class: "btn btn-success offset-md-1" %>-->
    <!--  <%= link_to 'å‰Šé™¤ã™ã‚‹', post_path(@post), method: :delete, "data-confirm" => "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹?", class: "btn btn-danger" %>-->
    <!-- <% end %>-->
    <!--</div>-->
   </div>
 </div>
<div class ="border-bottom border-dark mt-4"></div>
</div>

<div class ="container">
   <div class ="col-12 mt-3">
    <div>
     <% @post.comments.each do |comment| %>
      <%= comment.created_at.strftime('%Y/%m/%d') %>&nbsp;&nbsp;
      <%= comment.user.name %>ã€€ã€€<%= comment.comment %>
      <% if comment.user == current_user %>
       <%= link_to 'å‰Šé™¤', post_comment_path(comment.post, comment), method: :delete %>
      <% end %><br>
     <% end %>
    </div>
    <div>
    <%= form_with model: [@post, @comment] do |f| %>
      <%= f.text_area :comment, rows: '3', placeholder: "ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã“ã“ã«" %>
      <%= f.submit "é€ä¿¡ã™ã‚‹", class: 'btn btn-primary' %>
    <% end %>
    </div>
   </div>
</div>

<script>
       var show_elem = document.querySelector('#show_star')
       $('#show_star').empty();
         // scriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã®idã®éƒ¨åˆ†ã«é…ç½®ã™ã‚‹ã‹ã‚’æŒ‡å®š
       var show_opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        half: true,
        score: <%= @post.rate %>
         //æ˜Ÿç”»åƒã®æŒ‡å®šãªã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã“ã“ã«è¨˜è¿°,
        };
      raty(show_elem,show_opt);
        //application.jsã®20è¡Œç›®ã®ratyã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
</script>

<script>
  function initMap() {
   //latitude, longitudeã‹ã‚‰ä½ç½®ã‚’ç‰¹å®š
    var test ={lat: <%= @post.latitude %>, lng: <%= @post.longitude %>};
    var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15,
              center: test
              });
    var transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);

    var contentString = 'ä½æ‰€:<%= @post.address %>';
    var infowindow = new google.maps.InfoWindow({
     content: contentString
    });

   //Mapä¸Šã®æŒ‡å®šã—ãŸä½ç½®ã«ãƒ”ãƒ³ã‚’ã•ã—ã¦è¡¨ç¤ºã™ã‚‹
    var marker = new google.maps.Marker({
                  position:test,
                  map: map,
                  title: contentString
                  });

    marker.addListener('click', function() {
     infowindow.open(map, marker);
    });
  }
</script>

<script async defer
          src ="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyBc-L4J15-3auQw4NpuU8yf8gRjPP3D2SQ&callback=initMap">
</script>

